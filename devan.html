<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« â€“ é¡§å®¢/ç®¡ç† çµ±åˆ</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { view-transition-name: root; }
    body { box-sizing: border-box; }
    .status-badge, .status-select { transition: all .2s ease; }
    .status-select { cursor: pointer; }
    .status-select:hover { opacity:.9; }
    .loading-spinner { border: 2px solid #f3f4f6; border-top: 2px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
    @keyframes spin { 0%{ transform:rotate(0) } 100%{ transform:rotate(360deg) } }
    .customer-header { background: linear-gradient(135deg,#4f46e5 0%, #06b6d4 100%); }
    .admin-header { background: linear-gradient(135deg,#667eea 0%, #764ba2 100%); }
  </style>
</head>
<body class="min-h-full bg-gray-50">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
    <div class="flex items-center justify-between mb-4">
      <div class="text-sm text-gray-500">ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼š
        <button id="to-customer" class="ml-2 px-3 py-1 rounded-md bg-white border text-gray-700 hover:bg-gray-100">é¡§å®¢ç”¨</button>
        <button id="to-admin" class="ml-2 px-3 py-1 rounded-md bg-white border text-gray-700 hover:bg-gray-100">ç®¡ç†è€…ç”¨</button>
      </div>
      <div class="text-xs text-gray-400">URL ã‚¯ã‚¨ãƒªã§ã‚‚åˆ‡æ›¿å¯ï¼š<code>?mode=customer</code> / <code>?mode=admin</code></div>
    </div>

    <!-- ===== ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ ===== -->
    <div id="admin-login" class="bg-white rounded-lg shadow-md p-6 mb-8 border-l-4 border-purple-500 hidden">
      <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
        <svg class="h-6 w-6 text-purple-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c1.657 0 3-1.567 3-3.5S13.657 4 12 4 9 5.567 9 7.5 10.343 11 12 11zm-7 9a7 7 0 0114 0H5z"/></svg>
        ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
      </h2>
      <!-- ä¿®æ­£ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’å‚ç›´ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å¤‰æ›´ -->
      <form id="login-form" class="space-y-4 max-w-md">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ID</label>
          <input id="login-id" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="admin" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input id="login-pass" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="0000" />
        </div>
        <div>
          <button id="login-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
      </form>
      <p class="text-xs text-gray-500 mt-2">ãƒ’ãƒ³ãƒˆ: åˆæœŸå€¤ ID <code>admin</code> / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ <code>0000</code></p>
    </div>

    <!-- ===== é¡§å®¢ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ ===== -->
    <header id="customer-header" class="mb-8 hidden">
      <div class="customer-header rounded-lg p-6 text-white mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 id="page-title-cust" class="text-3xl font-bold mb-2">ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
            <p id="company-name" class="text-blue-100">æ ªå¼ä¼šç¤¾â—‹â—‹</p>
            <p class="text-blue-100 text-sm mt-1">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° - æœ€æ–°ã®é€²æ—çŠ¶æ³ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™</p>
          </div>
          <div class="text-right">
            <button id="refresh-btn" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg px-4 py-2 transition-colors duration-200">
              <svg id="refresh-icon" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              <span class="text-sm font-medium">æ›´æ–°</span>
            </button>
            <p class="text-xs text-blue-100 mt-1">æœ€çµ‚æ›´æ–°: <span id="last-update">--:--</span></p>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== é¡§å®¢ç”¨ï¼šçµ±è¨ˆã‚µãƒãƒªãƒ¼ ===== -->
    <!-- ä¿®æ­£ï¼šé¡§å®¢ç”¨çµ±è¨ˆã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ  -->
    <div id="customer-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 hidden">
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center">
          <div class="p-2 bg-blue-100 rounded-lg">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">ç·ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ•°</p>
            <p id="cust-total" class="text-2xl font-bold text-gray-900">0</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center">
          <div class="p-2 bg-gray-100 rounded-lg">
            <svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">äºˆå®š</p>
            <p id="cust-scheduled" class="text-2xl font-bold text-gray-900">0</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center">
          <div class="p-2 bg-blue-100 rounded-lg">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">é€²è¡Œä¸­</p>
            <p id="cust-inprogress" class="text-2xl font-bold text-gray-900">0</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center">
          <div class="p-2 bg-green-100 rounded-lg">
            <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">å®Œäº†</p>
            <p id="cust-completed" class="text-2xl font-bold text-gray-900">0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== é¡§å®¢ç”¨ï¼šä¸€è¦§ ===== -->
    <div id="customer-list-wrap" class="bg-white rounded-lg shadow-md overflow-hidden hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-xl font-semibold text-gray-800">ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§</h2>
            <p id="cust-record-count" class="text-sm text-gray-600 mt-1">0ä»¶ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2">
              <div class="flex items-center"><div class="w-3 h-3 bg-gray-500 rounded-full mr-1"></div><span class="text-xs text-gray-600">äºˆå®š</span></div>
              <div class="flex items-center"><div class="w-3 h-3 bg-blue-500 rounded-full mr-1"></div><span class="text-xs text-gray-600">é€²è¡Œä¸­</span></div>
              <div class="flex items-center"><div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div><span class="text-xs text-gray-600">å®Œäº†</span></div>
              <div class="flex items-center"><div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div><span class="text-xs text-gray-600">ä¿ç•™</span></div>
            </div>
          </div>
        </div>
      </div>
      <div id="customer-list" class="divide-y divide-gray-200">
        <div id="cust-empty" class="px-6 py-12 text-center text-gray-500">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
          <p class="text-lg font-medium mb-2">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
          <p class="text-sm">ç®¡ç†è€…ã«ã‚ˆã£ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç™»éŒ²ã•ã‚Œã‚‹ã¨ã€ã“ã¡ã‚‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
      </div>
    </div>

    <!-- ===== ç®¡ç†è€…ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ ===== -->
    <header id="admin-header" class="mb-8 hidden">
      <div class="admin-header rounded-lg p-6 text-white mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 id="page-title-admin" class="text-3xl font-bold mb-2">ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h1>
            <p class="text-blue-100">ç®¡ç†è€…ç”¨ - å…¨ã¦ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†</p>
          </div>
          <div class="bg-white bg-opacity-20 rounded-lg px-2 py-2 flex items-center space-x-2">
            <span class="text-sm font-medium">ğŸ” ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰</span>
            <button id="logout-btn" class="text-xs bg-white bg-opacity-30 hover:bg-opacity-40 rounded px-2 py-1">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== ç®¡ç†è€…ç”¨ï¼šæ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  ===== -->
    <div id="admin-form" class="bg-white rounded-lg shadow-md p-6 mb-8 border-l-4 border-blue-500 hidden">
      <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
        <svg class="h-6 w-6 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
        æ–°è¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ 
      </h2>
      <form id="add-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label for="container-number" class="block text-sm font-medium text-gray-700 mb-1">ã‚³ãƒ³ãƒ†ãƒŠç•ªå·</label>
          <textarea id="container-number" name="container_number" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="ä¾‹: ABCD1234567&#10;EFGH2345678&#10;IJKL3456789&#10;ï¼ˆ1è¡Œã«1ã¤ãšã¤å…¥åŠ›ï¼‰" required></textarea>
          <p class="text-xs text-gray-500 mt-1">è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠç•ªå·ã‚’1è¡Œã«1ã¤ãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>
        <div>
          <label for="devan-date" class="block text-sm font-medium text-gray-700 mb-1">ãƒ‡ãƒãƒ³äºˆå®šæ—¥</label>
          <input type="date" id="devan-date" name="devan_date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required />
        </div>
        <div>
          <label for="devan-status" class="block text-sm font-medium text-gray-700 mb-1">ãƒ‡ãƒãƒ³çŠ¶æ³</label>
          <select id="devan-status" name="devan_status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="äºˆå®š">äºˆå®š</option>
            <option value="é€²è¡Œä¸­">é€²è¡Œä¸­</option>
            <option value="å®Œäº†">å®Œäº†</option>
            <option value="ä¿ç•™">ä¿ç•™</option>
          </select>
        </div>
        <div class="flex items-end">
          <button type="submit" id="add-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center">
            <span id="add-button-text">æ–°è¦è¿½åŠ </span>
            <div id="add-loading" class="loading-spinner ml-2 hidden"></div>
          </button>
        </div>
      </form>
    </div>

    <!-- ===== ç®¡ç†è€…ç”¨ï¼šçµ±è¨ˆ ===== -->
    <div id="admin-stats" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 hidden">
      <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="p-2 bg-blue-100 rounded-lg"><svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg></div><div class="ml-4"><p class="text-sm font-medium text-gray-600">ç·ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ•°</p><p id="adm-total" class="text-2xl font-bold text-gray-900">0</p></div></div></div>
      <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="p-2 bg-gray-100 rounded-lg"><svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div class="ml-4"><p class="text-sm font-medium text-gray-600">äºˆå®š</p><p id="adm-scheduled" class="text-2xl font-bold text-gray-900">0</p></div></div></div>
      <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="p-2 bg-blue-100 rounded-lg"><svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg></div><div class="ml-4"><p class="text-sm font-medium text-gray-600">é€²è¡Œä¸­</p><p id="adm-inprogress" class="text-2xl font-bold text-gray-900">0</p></div></div></div>
      <div class="bg-white rounded-lg shadow p-6"><div class="flex items-center"><div class="p-2 bg-green-100 rounded-lg"><svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div class="ml-4"><p class="text-sm font-medium text-gray-600">å®Œäº†</p><p id="adm-completed" class="text-2xl font-bold text-gray-900">0</p></div></div></div>
    </div>

    <!-- ===== ç®¡ç†è€…ç”¨ï¼šä¸€è¦§ ===== -->
    <div id="admin-list-wrap" class="bg-white rounded-lg shadow-md overflow-hidden hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-xl font-semibold text-gray-800">ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§</h2>
            <p id="adm-record-count" class="text-sm text-gray-600 mt-1">0ä»¶ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
          </div>
          <div class="flex space-x-2"></div>
        </div>
      </div>
      <div id="admin-list" class="divide-y divide-gray-200">
        <div id="adm-empty" class="px-6 py-12 text-center text-gray-500">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
          <p class="text-lg font-medium mb-2">ã¾ã ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
          <p class="text-sm">ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ–°ã—ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
        </div>
      </div>
    </div>

    <footer class="mt-8 text-center text-gray-500 text-sm">
      <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ã®æƒ…å ±ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
    </footer>
  </div>

  <script>
    // ===== å…±é€šè¨­å®š =====
    const defaultConfig = {
      page_title: "ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
      company_name: "æ ªå¼ä¼šç¤¾â—‹â—‹",
      add_button_text: "æ–°è¦è¿½åŠ ",
      status_options: "äºˆå®š,é€²è¡Œä¸­,å®Œäº†,ä¿ç•™",
      primary_color: "#3b82f6",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      success_color: "#10b981",
      warning_color: "#f59e0b"
    };

    let scheduleData = [];

    // ===== ç°¡æ˜“èªè¨¼ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ»ç°¡æ˜“é‹ç”¨å‘ã‘ï¼‰ =====
    const ADMIN_CREDENTIALS = { user: 'kokusai', pass: 'kokusaitokyo' };
    function isAuthed(){
      try { return localStorage.getItem('devan_admin_authed') === '1'; }
      catch (e) { return false; }
    }
    function setAuthed(v){
      try {
        if (v) { localStorage.setItem('devan_admin_authed','1'); }
        else { localStorage.removeItem('devan_admin_authed'); }
      } catch (e) {}
    }
    function showLogin(show){
      var el = document.getElementById('admin-login');
      if (el) { el.classList.toggle('hidden', !show); }
    }

    // ===== SDK ãŒç„¡ã„ç’°å¢ƒå‘ã‘ãƒ¢ãƒƒã‚¯ =====
    (function ensureSdk(){
      // dataSdk ã®ãƒ­ãƒ¼ã‚«ãƒ«æ°¸ç¶šç‰ˆï¼ˆSDKä¸è¦ï¼‰
      if (!window.dataSdk) {
        console.warn('dataSdk ãŒç„¡ã„ãŸã‚ã€localStorage+BroadcastChannel ç‰ˆã‚’ä½¿ç”¨ã—ã¾ã™');
        var STORAGE_KEY = 'devan_schedules_v1';
        var CHANNEL = 'devan_bus';
        var bc = ('BroadcastChannel' in window) ? new BroadcastChannel(CHANNEL) : null;
        var listeners = new Set();

        var load = function(){
          try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
          catch (e) { return []; }
        };
        var notify = function(){ listeners.forEach(function(fn){ fn(load()); }); };
        var save = function(data){
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          if (bc) bc.postMessage({ type: 'changed' });
          notify();
        };

        // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆåˆå›ã ã‘ï¼‰
        if (!localStorage.getItem(STORAGE_KEY)) {
          var seed = [
            { __backendId: (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+'-1'), container_number: 'OOCU8027781', devan_date: new Date(Date.now()+86400000).toISOString(), devan_status:'äºˆå®š', created_at: new Date().toISOString() },
            { __backendId: (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+'-2'), container_number: 'TIIU2029097', devan_date: new Date().toISOString(), devan_status:'é€²è¡Œä¸­', created_at: new Date().toISOString() },
            { __backendId: (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+'-3'), container_number: 'TSSU2079420', devan_date: new Date(Date.now()-86400000*2).toISOString(), devan_status:'å®Œäº†', created_at: new Date().toISOString() }
          ];
          localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
        }

        // storage/BC ã§ä»–ã‚¿ãƒ–ã¨åŒæœŸ
        if (bc) bc.addEventListener('message', function(e){ if (e && e.data && e.data.type === 'changed') notify(); });
        window.addEventListener('storage', function(e){ if (e.key === STORAGE_KEY) notify(); });

        window.dataSdk = {
          init: async function(handler){
            if (handler && handler.onDataChanged) { listeners.add(handler.onDataChanged); handler.onDataChanged(load()); }
            return { isOk: true };
          },
          create: async function(item){
            var withId = Object.assign({
              __backendId: (item && item.__backendId) ? item.__backendId : (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+'-x'),
              created_at: (item && item.created_at) ? item.created_at : new Date().toISOString()
            }, item || {});
            var data = load(); data.push(withId); save(data); return { isOk: true, data: withId };
          },
          update: async function(item){
            var data = load().map(function(s){ return s.__backendId === item.__backendId ? Object.assign({}, s, item) : s; });
            save(data); return { isOk: true };
          },
          delete: async function(item){
            var data = load().filter(function(s){ return s.__backendId !== item.__backendId; });
            save(data); return { isOk: true };
          }
        };
      }

      // elementSdk ã®ç°¡æ˜“ãƒ¢ãƒƒã‚¯
      if (!window.elementSdk) {
        console.warn('elementSdk ãŒç„¡ã„ãŸã‚ã€ç°¡æ˜“ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™');
        window.elementSdk = {
          config: Object.assign({}, defaultConfig),
          init: function(opts){ this.config = Object.assign({}, opts && opts.defaultConfig ? opts.defaultConfig : defaultConfig); this._onChange = opts && opts.onConfigChange; if (this._onChange) this._onChange(this.config); },
          setConfig: function(patch){ this.config = Object.assign({}, this.config, patch || {}); if (this._onChange) this._onChange(this.config); }
        };
      }
    })();

    // ===== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
    function getStatusColor(status){
      var cfg = (window.elementSdk && window.elementSdk.config) ? window.elementSdk.config : defaultConfig;
      switch(status){
        case 'äºˆå®š': return '#6b7280';
        case 'é€²è¡Œä¸­': return cfg.primary_color || defaultConfig.primary_color;
        case 'å®Œäº†': return cfg.success_color || defaultConfig.success_color;
        case 'ä¿ç•™': return cfg.warning_color || defaultConfig.warning_color;
        default: return '#6b7280';
      }
    }

    var dataHandler = { onDataChanged: function(data){ scheduleData = data; renderAll(); } };

    function jpDate(d){
      var dt = new Date(d);
      if (Number.isNaN(+dt)) return '-';
      return dt.toLocaleDateString('ja-JP', { year:'numeric', month:'long', day:'numeric', weekday:'short' });
    }

    // ===== é¡§å®¢ç”¨æç”» =====
    function renderCustomer(){
      var list = document.getElementById('customer-list');
      var empty = document.getElementById('cust-empty');
      if (!list) return;

      var sorted = scheduleData.slice().sort(function(a,b){ return new Date(b.devan_date) - new Date(a.devan_date); });
      list.querySelectorAll('[data-id]').forEach(function(n){ n.remove(); });

      if(sorted.length===0){ empty.style.display='block'; } else { empty.style.display='none'; }

      for(var i=0;i<sorted.length;i++){
        var s = sorted[i];
        var row = document.createElement('div');
        row.dataset.id = s.__backendId;
        row.className = 'px-6 py-4 hover:bg-gray-50 transition-colors duration-150';

        // ä¿®æ­£ï¼šHTMLæ–‡å­—åˆ—ã‚’1è¡Œã§è¨˜è¿°
        row.innerHTML = '<div class="flex items-center"><div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4"><div><p class="text-sm font-medium text-gray-900">'+s.container_number+'</p><p class="text-xs text-gray-500">ã‚³ãƒ³ãƒ†ãƒŠç•ªå·</p></div><div><p class="text-sm text-gray-900">'+jpDate(s.devan_date)+'</p><p class="text-xs text-gray-500">ãƒ‡ãƒãƒ³äºˆå®šæ—¥</p></div><div class="flex items-center"><span class="status-badge inline-flex items-center px-3 py-1 rounded-full text-sm font-medium text-white" style="background-color:'+getStatusColor(s.devan_status)+'">'+s.devan_status+'</span></div></div></div>';

        list.appendChild(row);
      }

      // stats
      document.getElementById('cust-total').textContent = String(scheduleData.length);
      document.getElementById('cust-scheduled').textContent = String(scheduleData.filter(function(s){return s.devan_status==='äºˆå®š';}).length);
      document.getElementById('cust-inprogress').textContent = String(scheduleData.filter(function(s){return s.devan_status==='é€²è¡Œä¸­';}).length);
      document.getElementById('cust-completed').textContent = String(scheduleData.filter(function(s){return s.devan_status==='å®Œäº†';}).length);
      document.getElementById('cust-record-count').textContent = scheduleData.length + 'ä»¶ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«';
    }

    // ===== ç®¡ç†è€…ç”¨æç”» =====
    function renderAdmin(){
      var list = document.getElementById('admin-list');
      var empty = document.getElementById('adm-empty');
      if (!list) return;

      list.querySelectorAll('[data-id]').forEach(function(n){ n.remove(); });

      if(scheduleData.length===0){ empty.style.display='block'; } else { empty.style.display='none'; }

      for(var i=0;i<scheduleData.length;i++){
        var s = scheduleData[i];
        var row = document.createElement('div');
        row.dataset.id = s.__backendId;
        row.className = 'px-6 py-4 hover:bg-gray-50 transition-colors duration-150';

        var optsRaw = (window.elementSdk && window.elementSdk.config && window.elementSdk.config.status_options) ? window.elementSdk.config.status_options : defaultConfig.status_options;
        var options = optsRaw.split(',').map(function(o){ return o.trim(); });

        // ä¿®æ­£ï¼šHTMLæ–‡å­—åˆ—ã‚’1è¡Œã§è¨˜è¿°
        row.innerHTML = '<div class="flex items-center justify-between"><div class="flex-1 grid grid-cols-1 md:grid-cols-4 gap-4"><div><p class="text-sm font-medium text-gray-900">'+s.container_number+'</p><p class="text-xs text-gray-500">ã‚³ãƒ³ãƒ†ãƒŠç•ªå·</p></div><div><p class="text-sm text-gray-900">'+new Date(s.devan_date).toLocaleDateString('ja-JP')+'</p><p class="text-xs text-gray-500">ãƒ‡ãƒãƒ³äºˆå®šæ—¥</p></div><div class="flex items-center"><select data-sel="'+s.__backendId+'" class="status-select text-xs font-medium text-white rounded-full px-2.5 py-0.5 border-none focus:outline-none" style="background-color:'+getStatusColor(s.devan_status)+'">'+options.map(function(v){ return '<option value="'+v+'" '+(v===s.devan_status?'selected':'')+'>'+v+'</option>'; }).join('')+'</select></div><div><p class="text-sm text-gray-900">'+new Date(s.created_at).toLocaleDateString('ja-JP')+'</p><p class="text-xs text-gray-500">ç™»éŒ²æ—¥</p></div></div><div class="ml-4 flex space-x-2"><button data-del="'+s.__backendId+'" class="text-red-600 hover:text-red-800 transition-colors duration-150 p-1" aria-label="å‰Šé™¤"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div>';

        list.appendChild(row);
      }

      // stats
      document.getElementById('adm-total').textContent = String(scheduleData.length);
      document.getElementById('adm-scheduled').textContent = String(scheduleData.filter(function(s){return s.devan_status==='äºˆå®š';}).length);
      document.getElementById('adm-inprogress').textContent = String(scheduleData.filter(function(s){return s.devan_status==='é€²è¡Œä¸­';}).length);
      document.getElementById('adm-completed').textContent = String(scheduleData.filter(function(s){return s.devan_status==='å®Œäº†';}).length);
      document.getElementById('adm-record-count').textContent = scheduleData.length + 'ä»¶ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«';

      // wire events
      list.querySelectorAll('select[data-sel]').forEach(function(sel){
        sel.onchange = async function(){
          sel.disabled = true; sel.style.opacity = 0.6;
          var id = sel.getAttribute('data-sel');
          var s = scheduleData.find(function(x){ return x.__backendId===id; });
          if(!s){ sel.disabled=false; sel.style.opacity=1; return; }
          var next = Object.assign({}, s, {devan_status: sel.value});
          var r = await window.dataSdk.update(next);
          sel.disabled = false; sel.style.opacity = 1;
          if(!(r && r.isOk)){ sel.value = s.devan_status; toast('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ','error'); }
        };
      });
      list.querySelectorAll('button[data-del]').forEach(function(btn){
        btn.onclick = async function(){
          var id = btn.getAttribute('data-del');
          var s = scheduleData.find(function(x){ return x.__backendId===id; });
          if(!s) return;
          var r = await window.dataSdk.delete(s);
          if(!(r && r.isOk)) toast('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ','error');
        };
      });
    }

    function renderAll(){
      renderCustomer();
      renderAdmin();
    }

    // ===== UI å…±æœ‰ =====
    function setLastUpdateNow(){
      var el = document.getElementById('last-update');
      if(!el) return; var now = new Date();
      el.textContent = now.toLocaleTimeString('ja-JP', { hour:'2-digit', minute:'2-digit' });
    }
    function toast(msg, type){
      if (type === void 0) type = 'success';
      var d = document.createElement('div');
      d.className = 'fixed top-4 right-4 px-4 py-2 rounded-md text-white z-50 ' + (type==='success'?'bg-green-500':'bg-red-500');
      d.textContent = msg; document.body.appendChild(d); setTimeout(function(){ d.remove(); }, 3000);
    }

    // ===== åˆæœŸåŒ– =====
    async function init(){
      // Data SDK
      var initRes = await window.dataSdk.init(dataHandler);
      if(!(initRes && initRes.isOk)) console.error('dataSdk åˆæœŸåŒ–å¤±æ•—');

      // Element SDK
      window.elementSdk.init({ defaultConfig: defaultConfig, onConfigChange: function(cfg){
        document.getElementById('page-title-cust').textContent = cfg.page_title || defaultConfig.page_title;
        document.getElementById('page-title-admin').textContent = cfg.page_title || 'ãƒ‡ãƒãƒ³ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†';
        document.getElementById('company-name').textContent = cfg.company_name || defaultConfig.company_name;
        renderAll();
      }});

      // Refresh button (customer)
      var refreshBtn = document.getElementById('refresh-btn');
      if (refreshBtn) {
        refreshBtn.onclick = function(){
          var icon = document.getElementById('refresh-icon');
          icon.classList.add('animate-spin');
          setTimeout(function(){
            icon.classList.remove('animate-spin');
            setLastUpdateNow();
          }, 800);
        };
      }
      setLastUpdateNow();

      // Add form (admin)
      var form = document.getElementById('add-form');
      if (form) {
        form.addEventListener('submit', async function(e){
          e.preventDefault();
          var addBtn = document.getElementById('add-button');
          var spinner = document.getElementById('add-loading');
          addBtn.disabled = true;
          spinner.classList.remove('hidden');

          var fd = new FormData(form);
          var numbers = String(fd.get('container_number')||'').split('\n').map(function(x){return x.trim();}).filter(function(x){return !!x;});
          var date = fd.get('devan_date');
          var status = fd.get('devan_status');

          if(numbers.length===0){
            toast('ã‚³ãƒ³ãƒ†ãƒŠç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error');
            addBtn.disabled=false;
            spinner.classList.add('hidden');
            return;
          }

          var ok=0, ng=0;
          for(var i=0;i<numbers.length;i++){
            var num = numbers[i];
            var item = { container_number:num, devan_date: date, devan_status: status, created_at: new Date().toISOString() };
            var r = await window.dataSdk.create(item);
            (r && r.isOk) ? ok++ : ng++;
          }
          form.reset();
          addBtn.disabled=false;
          spinner.classList.add('hidden');
          toast(ok+'ä»¶è¿½åŠ '+(ng? 'ã€'+ng+'ä»¶å¤±æ•—':'')+(ng? '':'ã—ã¾ã—ãŸ'), ng?'error':'success');
        });
      }

      // Mode switching
      function applyMode(mode){
        var wantAdmin = mode==='admin';
        var authed = isAuthed();
        var isAdmin = wantAdmin && authed;

        // é¡§å®¢è¡¨ç¤º
        document.getElementById('customer-header').classList.toggle('hidden', isAdmin || wantAdmin);
        document.getElementById('customer-stats').classList.toggle('hidden', isAdmin || wantAdmin);
        document.getElementById('customer-list-wrap').classList.toggle('hidden', isAdmin || wantAdmin);

        // ç®¡ç†è¡¨ç¤º
        document.getElementById('admin-header').classList.toggle('hidden', !isAdmin);
        document.getElementById('admin-form').classList.toggle('hidden', !isAdmin);
        document.getElementById('admin-stats').classList.toggle('hidden', !isAdmin);
        document.getElementById('admin-list-wrap').classList.toggle('hidden', !isAdmin);

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
        showLogin(wantAdmin && !authed);
      }

      var params = new URLSearchParams(location.search);
      applyMode(params.get('mode')==='admin' ? 'admin' : 'customer');

      document.getElementById('to-customer').onclick = function(){
        applyMode('customer');
        history.replaceState(null,'',location.pathname+'?mode=customer');
      };
      document.getElementById('to-admin').onclick = function(){
        applyMode('admin');
        history.replaceState(null,'',location.pathname+'?mode=admin');
      };

      // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
      var loginForm = document.getElementById('login-form');
      if (loginForm){
        loginForm.addEventListener('submit', function(e){
          e.preventDefault();
          var u = (document.getElementById('login-id')||{}).value || '';
          var p = (document.getElementById('login-pass')||{}).value || '';
          if(u.trim()===ADMIN_CREDENTIALS.user && p===ADMIN_CREDENTIALS.pass){
            setAuthed(true); toast('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ'); applyMode('admin');
          } else { toast('ID ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™','error'); }
        });
      }

      var logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn){
        logoutBtn.onclick = function(){
          setAuthed(false);
          toast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
          applyMode('customer');
        };
      }

      renderAll();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>